<h1 align="center" style="border-bottom: none">
    <a href="https://github.com/mx-ulises/certification-prep-cka-ckad" target="_blank">
        <img alt="" src="https://github.com/mx-ulises/certification-prep-cka-ckad/blob/main/assets/notes-logo.png?raw=true" style="border-radius: 50%; height: 100px;">
    </a>
    <br>
    CKAD Lesson 2: Managing Container Images
</h1>
<h3 align="center" style="border-bottom: none">
    Notes by: <a href="https://github.com/mx-ulises" target="_blank">Ulises Martinez</a>
</h3>
<hr />

<p align="center">
    Auto-generated by the <a href="https://github.com/WhitneyLampkin/devscriber" target="_blank">DevScriber</a> command-line tool.
</p>

<div align="center">

![GitHub language count](https://img.shields.io/github/languages/count/mx-ulises/certification-prep-cka-ckad?label=Languages)
![GitHub contributors](https://img.shields.io/github/contributors/mx-ulises/certification-prep-cka-ckad?label=Contributors&color=yellow)
![GitHub repo size](https://img.shields.io/github/repo-size/mx-ulises/certification-prep-cka-ckad?label=Repo%20Size&color=teal)
![GitHub repo file count (file type)](https://img.shields.io/github/directory-file-count/mx-ulises/certification-prep-cka-ckad?label=Files&color=purple)

</div>

## Introduction

The image is the foundation of each container. In this lesson, we explore image architecture, how to version images using tags, and methods of image creation.

## Image architecture

A container image is a tar file with metadata. It has multiple filesystem layers, each containing foundational requirements for the next layer. When building images, a base system image is used, such as BusyBox or Alpine for simple scenarios, or Ubuntu for more complex ones. On top of this base system image, application layers are installed. Standard images already consist of multiple layers. The use of layers helps to build images efficiently.

## Tagging container images

| Command | Description |
|-|-|
| `docker image ls` | List Docker images. |
| `docker image rm` | Remove one or more Docker images. |
| `docker image history` | Show the history of an image, including layers. |
| `docker tag` | Create a tag `TARGET_IMAGE` that refers to `SOURCE_IMAGE`. |
| `docker push` | Push an image or a repository to a registry. |
| `docker image --help` | Display help information for Docker image commands. |

Tags allow you to assign names to images, making it easier to manage versions. If no tag is added, the `latest` tag is used by default. Tagging images will display them as different image versions with `docker image ls`.

Tags can be used to identify the target registry, and they are required for `docker push`.

## Image creation

There are two options for creating images:

 - Create an image from a running container using `docker commit`.
 - Create an image from a container file. This is the preferred method.

To manage containers, you can also use [buildah](https://buildah.io/). It is a solution for creating, modifying, and managing container images.

### ⭐ Dockerfiles

The `Dockerfile` (or `Containerfile`) is the container file with instructions to build the image. Each instruction adds a new layer to the image and offers control over the files added to the image. It is similar to writing a script and can be stored in source control for version management. Container images were introduced to automate the building of container images.

Container images have Parent/Child image relationships: A Child image is created from a parent image using the layers from the parent. Starting from parent images makes it easier to build reliable images, as the parent contains your dependencies, and your child image layers contain your application.

Building images from container files requires that you have a working directory. You will write the `Dockerfile` with the instructions to build the images in that directory. The `Dockerfile` requires the following:

 - ***Parent image***: It is identified using `FROM` and a tag. All instructions from the parent image are executed, followed by the ones in the Dockerfile.
 - ***Build instructions***: The instructions in a Dockerfile run in an independent container, using an intermediate image built from the previous command. Multiple commands will result in multiple layers. Fewer layers are preferred. Instructions include `ADD`, `COPY`, `RUN`.
   - ***Note***: To avoid creating multiple layers, `RUN` commands can be connected using the `&&` operator.
 - ***Entry point***: A command that the container will run when it starts, which is provided by using `ENTRYPOINT` (preferred) or `CMD`. Parameters can be provided. If the entry point is not specified, it will run `/bin/sh -c`.

To build an image, you will use `docker build -t name[:tag] directory`, where:

 - `name` is the name of the image.
 - `tag` is the optional tag for the image.
 - `directory` is the working directory containing the `Dockerfile`.

### ⭐ Docker commit

You can use a running container to create new container images. A container is started, and modifications are applied to the container. While it's an easy way, it's not the most efficient method as it may not be the cleanest way to install packages. The following commands are useful:

| Command | Description |
|-|-|
| `docker commit` | Create a new image from changes to a container. |
| `docker save` | Save one or more images to a tarball archive. |
| `docker load` | Load an image from a tarball archive. |

These are the instructions to create and distribute a container using a running container:

 - ***Start a container and make modifications***: You can run a container and make the changes you require.
 - ***Commit changes***: Use `docker commit` to commit your changes. This will create a new image in your local registry.
 - ***Save the image***: Create a tarball file of your container using `docker save`, so you can distribute it.
 - ***Load the image***: Load the image from your tarball file into your local registry with `docker load`.

<p align="center" style="border-bottom: none; margin-top: 50px;">
    <a href="https://github.com/mx-ulises/certification-prep-cka-ckad" target="_blank">
        <img alt="" src="https://github.com/mx-ulises/certification-prep-cka-ckad/blob/main/assets/notes-logo.png?raw=true" style="border-radius: 50%; height: 100px;">
    </a>
</p>
