<h1 align="center" style="border-bottom: none">
    <a href="https://github.com/mx-ulises/certification-prep-cka-ckad" target="_blank">
        <img alt="" src="https://github.com/mx-ulises/certification-prep-cka-ckad/blob/main/assets/notes-logo.png?raw=true" style="border-radius: 50%; height: 100px;">
    </a>
    <br>
    CKAD Lesson 8: Managing Networking
</h1>
<h3 align="center" style="border-bottom: none">
    Notes by: <a href="https://github.com/mx-ulises" target="_blank">Ulises Martinez</a>
</h3>
<hr />

<p align="center">
    Auto-generated by the <a href="https://github.com/WhitneyLampkin/devscriber" target="_blank">DevScriber</a> command-line tool.
</p>

<div align="center">

![GitHub language count](https://img.shields.io/github/languages/count/mx-ulises/certification-prep-cka-ckad?label=Languages)
![GitHub contributors](https://img.shields.io/github/contributors/mx-ulises/certification-prep-cka-ckad?label=Contributors&color=yellow)
![GitHub repo size](https://img.shields.io/github/repo-size/mx-ulises/certification-prep-cka-ckad?label=Repo%20Size&color=teal)
![GitHub repo file count (file type)](https://img.shields.io/github/directory-file-count/mx-ulises/certification-prep-cka-ckad?label=Files&color=purple)

</div>

## Introduction

In this lesson, we will review how to access our applications that run in the cluster. We will learn how to create services and how they use the Kubernetes DNS and how to create network policies.

## Kubernetes Networking

Usually in kubernetes, a set of pods represents an Applicaiton. There is a Pod internal network where each pod has an internal IP address. As applications has multiple Pod, you are not expected to access these Pods directly, for this we have the Cluster Network and a Node Network. The Node network is an External network that can be accesed from the internet. Kubernetes provide objects called Services that are internal node balancer for an application in the multiple Pods. These services connect the Cluster network and the Pod network.

## Services

A Kubernetes Service is an API object used to expose your application in the network (a set of Pods). Services use round-robin load balancing to forward traffic to specific Pods via a Label Selector. The kube-controller-manager will scan for Pods that match the selector for each Service. When Pods are added or removed, this is reflected inmediatly in the Service.

Services exists independently from the applications they open the access to. They only watches for Pods in the selector it is configured to track. A service can provide access to multiple Deployments and load balancing among Pods of both Deployments.

The kube-proxy agent on the nodes watches the Kubernetes API for new Services and endpoints (connected Pods). After creation, it opens random ports and listens for traffic to the Service port on the cluster IP address and redirects that traffic to the Pod in that endpoint. The kube-proxy agent works independently without requiring any configuration.

 - ClusterIP: Used for internal application communication within your Pods. It exposes the service on an internal cluster IP address.
 - NodePort: They expose a high level Port from the nodes and redirect the traffic to the actual ports. A node port is allocated to this service and it is accesible from external internet.
 - LoadBalancer: Implemented in public clouds with their own specification.
 - ExternalName: Works on DNS names; redirection is happening at a DNS level.

To create services you can use `kubectl expose` that can be used to create Services, providing access to deployments, ReplicaSets, Pods and other services. In most cases, it is used to expose Deployments. Alternative, `kubectl create service` can be used to create services. It is required to provide the `--port` argument to indicate the Service port. There are different type of ports that are specified:

 - `targetPort`: The port on the application that the service addresses. If not specified, it will default to the `port` value.
 - `port`: The port on which the service is accessible (usually the same as the `targetPort`).
 - `nodePort`: This is the port that is exposed externally while using the `NodePort` service type. This needs to be unique.

## Understanding Microservices and DNS

In Microservices application, different Pods are used to provide aplcation functionality. Backend services such as databases are usally exposed using ClusterIP Service type. Frontend and web servers can be exposed for external access using the NodePort Service type.

Exposed Services automatically register with the Kubernetes internal DNS. The coreDNS solves the problem of dynamic port allocation and resolution and it is a default component of Kubernetes. The coreDNS is updated every time new services are added, with this, Pods can access to any exposed service.

## NetworkPolicy

By default, there are no restrictions to network traffic in Kubernetes. Pod can always communicate, even if they are not in the same Namespace. To limit this, NetworkPolicies can be used. NetworkPolicies need to be supported by the network plugin. If in a policy there is no match, traffic will be denied. If there is no NetworkPolicy, there are no restrictions.

In NetworkPolicy, three different identifiers that can be used:
 - `Pod`: A `podSelector` is used, but a pod cannot restrict access to itsef.
 - `Namespace`: A `namespaceSelector` is used to grant access to specific namespaces.
 - `ipBlock`: An IP block is used, that always includes traffic to the node the Pod is running.

When defininf a `Pod` or `Namespace` Network Policy, a selector label is used to specify what traffic is allowed to and fro mthe Pods that match the selector.

`NetworkPolicies` are not conflicting but additive.

<p align="center" style="border-bottom: none; margin-top: 50px;">
    <a href="https://github.com/mx-ulises/certification-prep-cka-ckad" target="_blank">
        <img alt="" src="https://github.com/mx-ulises/certification-prep-cka-ckad/blob/main/assets/notes-logo.png?raw=true" style="border-radius: 50%; height: 100px;">
    </a>
</p>
