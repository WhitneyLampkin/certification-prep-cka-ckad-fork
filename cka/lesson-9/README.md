<h1 align="center" style="border-bottom: none">
    <a href="https://github.com/mx-ulises/certification-prep-cka-ckad" target="_blank">
        <img alt="" src="https://github.com/mx-ulises/certification-prep-cka-ckad/blob/main/assets/notes-logo.png?raw=true" style="border-radius: 50%; height: 100px;">
    </a>
    <br>
    CKA Lesson 9: Networking
</h1>
<h3 align="center" style="border-bottom: none">
    Notes by: <a href="https://github.com/mx-ulises" target="_blank">Ulises Martinez</a>
</h3>
<hr />

<p align="center">
    Auto-generated by the <a href="https://github.com/WhitneyLampkin/devscriber" target="_blank">DevScriber</a> command-line tool.
</p>

<div align="center">

![GitHub language count](https://img.shields.io/github/languages/count/mx-ulises/certification-prep-cka-ckad?label=Languages)
![GitHub contributors](https://img.shields.io/github/contributors/mx-ulises/certification-prep-cka-ckad?label=Contributors&color=yellow)
![GitHub repo size](https://img.shields.io/github/repo-size/mx-ulises/certification-prep-cka-ckad?label=Repo%20Size&color=teal)
![GitHub repo file count (file type)](https://img.shields.io/github/directory-file-count/mx-ulises/certification-prep-cka-ckad?label=Files&color=purple)

</div>

## Introduction

In this lesson we are going to learn about cluster-level networking. We are going to review how to manage the CNI and Network Plugins, how the coredns works and network policies to manage traffic between `Pod` and how to configure it.

## Container Network Interface (CNI) and Network Plugins

The CNI is the common interface used for networking when starting the kubelet on a worker node. CNI doesn't take care of networking itself, it is an interface that the network plugin will use. CNI ensures the pluggable nature of networking, and makes it easy to select between different plugins provided by the comunity.

The CNI plugin configuration is in `/etc/cni/net.d`. Some plugins have the complete network setup in this directory. Other Plugins have generic settings, and use additional configurations using `Pod` or custom API resources.

Resources of Calico are in the `kube-system` namespace, and it runs a `DaemonSet` that runs in all the nodes, it take care of the container network, and the rest of the network is managed by the API server.

## Service Autoregistration

Kybernetes runs the coredns service as a `Pod` in the kube-system banesoace as ubterbak DNS server. These `Pod` are exposed by the kubedns `Service`. Service register with this kubends `Service`. `Pod` are automatically configured with the IP address of the kubedns `Service` as as their DNS resolver.  As a result, all pods can access all `Service` by name.

If a `Service` is running in the same `Namespace`, it can be reached by the short hostname.

If a `Service` is running in another `namespace`, and FQDN consiting of `<serviceName>.<namespaceName>.svc.<clisterName>` must be used. The `<clusterName>` is defined in the coredns Corefile and set to `cluster.local` if it hasn't been changed, use the `kubectl get cm -n kube-system coredns -o yaml` to verify.

## Network Policies

By default, there are no restrictions to network traffic in kubernetes, and `Pod` can alwatys communicate among them, even if they are in different `Namespace`.

If the network plugin allow, `NetworkPolicy` can be used. Calico plugin have support fot this. If in a `NetworkPolicy`, no match is found, then traffic is denied. If no `NetworkPolicy` is used, then all traffic is allowed.

The `NetworkPolicy` uses identifiers:
 - `Pod`: Use `podSelector` to configure it. Note that a `Pod` cannot block access to itself.
 - `Namespace`: Use `namespace` to configure it.
 - IP Bblocks: Use `ipBlock`, note that traffic to and from where the `Pod` is running is always allowed.

When defined a `Pod` or `Namespace`-based `NetworkPolicy`, a selector label is ussed to specify what traffic is allowed. `NetworkPolicy` that are conflicting are additive (they will add permissions). Use `kubectl label pod <podname> <key>:<value>` to label a `Pod` to match with selectors for targets for the policy, ingress and egress.

To make a `NetworkPolicy` apply to a `Namespace`, we need to add the field `metadata.namespace` so it will apply to all `Pod` in the selected `Namespace`.

<p align="center" style="border-bottom: none; margin-top: 50px;">
    <a href="https://github.com/mx-ulises/certification-prep-cka-ckad" target="_blank">
        <img alt="" src="https://github.com/mx-ulises/certification-prep-cka-ckad/blob/main/assets/notes-logo.png?raw=true" style="border-radius: 50%; height: 100px;">
    </a>
</p>
