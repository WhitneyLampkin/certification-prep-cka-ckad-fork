<h1 align="center" style="border-bottom: none">
    <a href="https://github.com/mx-ulises/certification-prep-cka-ckad" target="_blank">
        <img alt="" src="https://github.com/mx-ulises/certification-prep-cka-ckad/blob/main/assets/notes-logo.png?raw=true" style="border-radius: 50%; height: 100px;">
    </a>
    <br>
    CKA Lesson 5: Managing Application Access
</h1>
<h3 align="center" style="border-bottom: none">
    Notes by: <a href="https://github.com/mx-ulises" target="_blank">Ulises Martinez</a>
</h3>
<hr />

<p align="center">
    Auto-generated by the <a href="https://github.com/WhitneyLampkin/devscriber" target="_blank">DevScriber</a> command-line tool.
</p>

<div align="center">

![GitHub language count](https://img.shields.io/github/languages/count/mx-ulises/certification-prep-cka-ckad?label=Languages)
![GitHub contributors](https://img.shields.io/github/contributors/mx-ulises/certification-prep-cka-ckad?label=Contributors&color=yellow)
![GitHub repo size](https://img.shields.io/github/repo-size/mx-ulises/certification-prep-cka-ckad?label=Repo%20Size&color=teal)
![GitHub repo file count (file type)](https://img.shields.io/github/directory-file-count/mx-ulises/certification-prep-cka-ckad?label=Files&color=purple)

</div>

## Introduction

In this lesson we will review how to provide access to applications, the role of the network plug-in and how network is configured in Kubernetes. To access application we will use `Service`, `Ingress` and configuring ingress and finally port forwarding for direct application access.

## Networking in Kubernetes

In Kubernetes, network happens at different levels:

 - Between containers: Implemented as Inter-Proccess Communication (IPC), that happens without IP and it is all within a linux processes.
 - Between Pods: Implemented by network plugins, that has software defined networks, where messages can be broadcasted for different Pods, no matter which node they are in.
 - Between Pods and Services: Implemented by the `Service` resource.
 - Between external users and Services: Implemented by `Service` with help of `Ingress`

### ‚≠ê Network Plug-ins

Network plug-ins are required to implement network traffic between Pods. They are not provided in vanilla kubernetes, but by the kubernetes ecosystem, this to not favor a single solution. Different plug-ins provide different features. Currently, Calico plug-in is commonly used because of its support for network policies.

## Using Services to access applications

`Service` resources are used to provide access to `Pod`. IF multiple `Pod` are used as `Service` endpoint, the `Service` will load balance traffic to the `Pod`. Different types of `Service` can be configured:

 - `ClusterIP`: The `Service` is internally exposed and is reachable only from within the cluster.
 - `NodePort`: The `Service` is exposed at each node's IP address as a port. The `Service` can be reached from outside the cluster ad `nodeip:nodeport`.
 - `LoadBalancer`: The cloud provider offers a load balancer that routes traffic to either `NodePort` or `ClusterIP` based services.
 - `ExternalName`: The `Service` is mappend to an external name that is implemented as a DNS CNAME record.

Use `kubectl expose` to expose applications trhough their `Pod`, `ReplicaSet` or `Deployment`. It can be used as well `kubectl create service` as an alternative.

## Running an Ingress Controller

`Ingress` is an API object that manages external access to services in a cluster. `Ingress` works with external DNS to provide URL-based access to Kubernetes applications. It consists of two parts:
 - A load balancer available on the external network
 - An API resource that contacts the `Service` resources to find out about available backend `Pod`

Ingress load balancers are provided by the Kubernetes ecosystem, different load balancers are avaialble. Ingress exposes HTTP and HTTPS routes from outside the cluster to `Service` within the cluster. It doesn't work with not HTTP/S applications. Ingress uses the selector label in `Services` to connect to the `Pod` endpoints. Trafficrouting is controlled by rules defined on the `Ingress` resource. Ingress can be configured to do the following things, depending of the functionality provided:
 - Give externable reachable URLs
 - Load balance traffic
 - Terminate SSL/TLS traffic
 - Offer name based virtual hosting

You need to isntall ingress controller. Usually, it can be done with helm:

```
helm upgrade --install ingress-nginx ingress-nginx --repo https://kubernetes.github.io/ingress-nginx --namespace ingress-nginx --create-namespace
```

To create an `Ingress` use:

```
kubectl create ingress <name> --class=nginx --rule=<virtualHost>=<service:port>
```

The `Ingress` catch incomming traffic that matches a specific path and optional hostname and connects that to a `Service` and port. Different paths or virtual hosts can be defined in the same host:

```
kubectl create ingress <name> --class=nginx --rule=<virtualHost1>=<service1:port1> --rule=<virtualHost2>=<service2:port2>
```

In one cluster, different ingres controllers can be hosted, each with its own configuration. Controllers can be included in an `IngressClass`. When creating an `Ingress`, the option `--class` option should be used to configure the ingress controller to be used; if this option is not used, a default `IngressClass` should be deffined with an annotation for it:

```
kubectl annotate ingressclass/<ingressClassName> ingressclass.kubernetes.io/is-default-class=true
```

After creating the ingress controller, an `IngressClass` API resource has been created.

## Port Forwarding for Direct Application Access

The command `kubectl port-forward` can be used to connect to applications for analyzing and troubleshooting. It forwwards traffic in to a local port on the kubectl client machine to a port that is available in a `Pod`. This is used to test application access without need to configure `Service` or `Ingress`

Use `kubectl port-forward <pod> 123:80` to forward your local port `1234` to `Pod` port `80`.

<p align="center" style="border-bottom: none; margin-top: 50px;">
    <a href="https://github.com/mx-ulises/certification-prep-cka-ckad" target="_blank">
        <img alt="" src="https://github.com/mx-ulises/certification-prep-cka-ckad/blob/main/assets/notes-logo.png?raw=true" style="border-radius: 50%; height: 100px;">
    </a>
</p>
