## Managing kernel modules

The kernel is the core of the operating system. It is an open source project written in C. It controls all major functions of the hardware, this enables the computer to use hardware by using drivers, that are implemented as kernel modules. It is the first part of the operating system htat is loaded while booting.

Usually, apps uses glibc to communicate with the kernel, and the kernel uses kernel modules to use hardware.

A kernel module is an object file containing code that extends the Linux kernel. An object file is what you get when you compile a file that is written in C. Kernel modules are obtained from the initramfs, that is created upon system installation to match all hardware found. Systemd-udevd is used as a plug-and-play manager to load kernel files dynamically when needed, but they can be loaded manually as well.

Kernel module parameters can be specified in include files in `/etc/modprobe.d/`

| Command          | Explanation                                                                                       |
|------------------|---------------------------------------------------------------------------------------------------|
| `lsmod`          | Lists all currently loaded kernel modules.                                                        |
| `modprobe`       | Loads a specified kernel module into the kernel.                                                  |
| `modprobe -r`    | Removes a specified kernel module from the kernel.                                                |
| `modinfo`        | Displays detailed information about a specified kernel module.                                    |
| `depmod`         | Generates modules dependency information for the kernel.                                          |

## Tunning the kernel

The `/proc` pseudo filesystem is used for kernel tunning and optimizations. You can write in the files in this filesystem to modify specific kernel parameters. Note that change are not persistent. These files contain runtime information about the kernel. The `status` file shows the information in the pid directories. The files in `/proc` with names `meminfo` and `cpuinfo` shows information about memory and cpu respectevely of the system. The directory `/proc/sys` has the tunnable details.

Sysctl provides an interface to manage parameters in `/proc`. It works with `/etc/sysctl.conf` and include files in `/etc/sysctl.d/` to include specific settings persistently. Parameters used in these files are relative filenames of files in `/proc/sys`.

| Command                                               | Explanation                                                                                       |
|-------------------------------------------------------|---------------------------------------------------------------------------------------------------|
| `mount | grep proc`                                   | Filters the output of the `mount` command to show only lines containing `proc` filesystems.       |
| `echo 60 > /proc/sys/vm/swappiness`                   | Sets the swappiness value to 60 temporarily (until the next reboot).                              |
| `man proc`                                            | Displays the manual page for the `proc` filesystem, detailing its purpose and contents.           |
| `sysctl -a`                                           | Lists all current kernel parameters and their values.                                             |
| `echo vm.swappiness=60 > /etc/sysctl.d/swappiness.conf` | Creates a configuration file to set the swappiness value to 60 permanently.                       |
| `sysctl -p /etc/sysctl.d/swappiness.conf`             | Applies the kernel parameters defined in the specified configuration file.                        |

## Managing Devices

The kernel itself is small and contains essential drivers only. Additional drivers are loaded dynamically with initramfs (loaded while booting) or systemd-udevd (loaded dynamically on demand). Devices files can be found in `/proc/dev`. The kernel doesn't know about filenames, it uses device major and minor to address devices. Linux use drivers to load kernel modules. The device files in `/dev` provide user interface to the devices, and they are usually autogenerated and correspond to the device nodes, which are the major and minor numbers used to be identified.

`/sys` is used to provide information about devices and their attributes. `/sys/devices` is dedicated to device information. After kernel initiates devices loading, it sends uevents to the systemd-udevd user space daemon. It chatches the event and decices how to handle it based on the attributes it recieves, net it reads its rules and acts based on these rules:
 * default rules: `/usr/lib/udev/rules.d`
 * custom rules: `/etc/udev/rules.d`

| Command                                              | Explanation                                                                                       |
|------------------------------------------------------|---------------------------------------------------------------------------------------------------|
| `mknod`                                              | Creates a special or ordinary file (e.g., device files).                                          |
| `less /proc/devices`                                 | Displays the list of currently registered device numbers along with their names.                  |
| `udevadm`                                            | A command-line tool for managing and debugging the `udev` device manager.                         |
| `udevadm info --query=all --name=/dev/sda`           | Queries all available information about the `/dev/sda` device.                                    |
| `udevadm info --attribute-walk --name=/dev/sda`      | Walks through the device chain and prints all attributes for the `/dev/sda` device.               |
| `udevadm monitor`                                    | Monitors `udev` events in real-time, displaying device addition, removal, and change events.       |
| `systemctl restart systemd-udevd`                    | Restarts the `systemd-udevd` service, which is responsible for managing device nodes.             |
